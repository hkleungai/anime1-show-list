doctype html
html(lang='zh-Hant')
    -   const year_group = Object.groupBy(list, x => x.year);
    -   const years = Object.keys(year_group).sort((a, b) => b - a);

    head
        meta(name='description' content='anime1.me 全季度動漫列表')
        meta(name='viewport' content='width=device-width, initial-scale=1.0')

        title.
            anime1.me 全季度動漫列表

        style(type='text/css').
            body {
                padding: 8px;
                font-size: 20px;
            }

            header {
                padding-bottom: 32px;
                font-size: 2em;
                font-weight: bold;
            }

            table, th, td {
                border: 1px solid black;
                border-collapse: collapse;
            }
            table {
                table-layout: fixed;
                width: 100%;
            }
            th {
                font-weight: normal;
                text-align: center;
            }
            td {
                word-break: break-word;
                padding: 4px;
            }

            a { text-decoration: none; }
            a:hover { text-decoration: underline; }

            .not-allowed { cursor: not-allowed; }

            main > input { display: none; }
            .year_group > section { display: none; }
            .year > input { display: none; }
            .season-group > table { display: none; }

            .label__outer {
                border: 1px solid black;
                border-bottom: 0;
                gap: 8px;
                padding: 8px;
            }

            .label__outer--flex {
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: center;
            }

            .label__outer--grid-col-5 {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            }

            .label__outer > label {
                width: 100%;
                text-align: center;
                align-content: center;
                border: 1px dotted black;
                border-radius: 10px;
                height: 38px;
            }

        -   let display_block = [];
        -   let display_table = [];
        -   let checked_label = [];
        -   let unchecked_label_hover = [];

        -   let year_count = 1;
        while year_count <= years.length
            -   const label = '.label__outer.label__outer--grid-col-5 label';
            -   const nth_type = `:nth-of-type(${year_count})`;
            -   const checked_input = `main > input${nth_type}:checked`;
            -   const unchecked_input = `main > input${nth_type}:not(:checked)`;
            -   display_block.push(`${checked_input} ~ .year_group section.year${nth_type}`);
            -   checked_label.push(`${checked_input} ~ ${label}${nth_type}`);
            -   unchecked_label_hover.push(`${unchecked_input} ~ ${label}${nth_type}:hover`);
            -   year_count += 1;

        -   let season_count = 1;
        while season_count <= 4
            -   const label = '.label__outer.label__outer--flex label';
            -   const nth_type = `:nth-of-type(${season_count})`;
            -   const checked_input = `.year > input${nth_type}:checked`;
            -   const unchecked_input = `.year > input${nth_type}:not(:checked)`;
            -   display_table.push(`${checked_input} ~ .season-group table${nth_type}`);
            -   checked_label.push(`${checked_input} ~ ${label}${nth_type}`);
            -   unchecked_label_hover.push(`${unchecked_input} ~ ${label}${nth_type}:hover`);
            -   season_count += 1;

        style(type='text/css').
            !{display_block.join(',\n')} {
                display: block;
            }

            !{display_table.join(',\n')} {
                display: table;
            }

            !{checked_label.join(',\n')} {
                color: black;
                font-weight: bold;
                border-style: solid;
                border-width: 2px;
            }

            !{unchecked_label_hover.join(',\n')} {
                cursor: pointer;
                color: black;
                font-size: 22px;
                margin-top: -1px;
                border-width: 2px;
            }
    body
        header.
            anime1.me 全季度動漫列表

        main
            -
                function create_year_toggle_label_id(year) {
                    return `input-id__year-toggle__${year}`;
                };

            -   let _year_count = 0;
            for year in years
                input(
                    type='radio'
                    name=`input-name__year-toggle`
                    id=create_year_toggle_label_id(year)
                    checked=(_year_count === 0)
                ).
                -   _year_count++

            div(class='label__outer label__outer--grid-col-5')
                for year in years
                    label(for=create_year_toggle_label_id(year)).
                        #{year}

            div(class='year_group')
                for year in years
                    section(class='year' id=year)
                        -   const season_group = Object.groupBy(year_group[year], x => x.season);
                        -
                            function create_season_toggle_label_id(season) {
                                return `input-id__season-toggle__${year}-${season}`;
                            };

                        -   let season_count = 0;

                        for _, season in season_group
                            input(
                                type='radio'
                                name=`input-name__season-toggle__${year}`
                                id=create_season_toggle_label_id(season)
                                checked=(season_count === 0)
                            ).

                            -   season_count++

                        div(class='label__outer label__outer--flex')
                            for _, season in season_group
                                label(for=create_season_toggle_label_id(season)).
                                    #{season}

                        div(class='season-group')
                            for season_shows, season in season_group
                                -
                                    const week_group = (
                                        Object.groupBy(season_shows, x => x.weekday)
                                    );

                                table
                                    thead
                                        tr
                                            for shows, weekday in week_group
                                                th.
                                                    #{weekday}

                                    tbody
                                        -   let row_height = 0;
                                        -
                                            const max_height = Math.max(
                                                ...Object.values(week_group).map(g => g.length)
                                            );

                                        while row_height < max_height
                                            tr
                                                for shows, weekday in week_group
                                                    td
                                                        if row_height < shows.length
                                                            -   const show = shows[row_height];

                                                            if show.link
                                                                a(href=show.link).
                                                                    #{show.name}
                                                            else
                                                                span(class='not-allowed').
                                                                    #{show.name}

                                            -   row_height += 1;
